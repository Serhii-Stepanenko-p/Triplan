name: Triplan CI/CD Pipeline

# 1. –ö–æ–ª–∏ –∑–∞–ø—É—Å–∫–∞—Ç–∏: –ø—Ä–∏ –∫–æ–∂–Ω–æ–º—É push (–∑–º—ñ–Ω—ñ –∫–æ–¥—É) –≤ –≥—ñ–ª–∫—É main
on:
  push:
    branches: [ "main", "master" ]
  workflow_dispatch: # –î–æ–∑–≤–æ–ª—è—î –∑–∞–ø—É—Å–∫–∞—Ç–∏ –≤—Ä—É—á–Ω—É –∫–Ω–æ–ø–∫—É

jobs:
  build-and-release:
    runs-on: ubuntu-latest
    
    # –î–æ–∑–≤–æ–ª—è—î–º–æ —Ü—å–æ–º—É –ø—Ä–æ—Ü–µ—Å—É —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ —Ñ–∞–π–ª–∏ (—Ä–µ–ª—ñ–∑–∏) –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó
    permissions:
      contents: write

    steps:
    # –ö—Ä–æ–∫ 1: –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –∫–æ–¥ –∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é
    - name: Checkout code
      uses: actions/checkout@v4

    # –ö—Ä–æ–∫ 2: –í–∏–≤–æ–¥–∏–º–æ –∞–≤—Ç–æ—Ä–∞ –∑–º—ñ–Ω (–ó–∞–≤–¥–∞–Ω–Ω—è 1.1)
    - name: Print Author Information
      run: |
        echo "üöÄ Pipeline started!"
        echo "üë§ Author of changes: ${{ github.actor }}"
        echo "üìÖ Date: $(date)"

    # –ö—Ä–æ–∫ 3: –ù–∞–ª–∞—à—Ç–æ–≤—É—î–º–æ Java (JDK 17)
    - name: Set up JDK 21
      uses: actions/setup-java@v4
      with:
        java-version: '21'
        distribution: 'temurin'
        cache:maven: true

    # –ö—Ä–æ–∫ 4: –ó–±–∏—Ä–∞—î–º–æ –ø—Ä–æ–µ–∫—Ç (Build) (–ó–∞–≤–¥–∞–Ω–Ω—è 1.2)
    # –í–∞–∂–ª–∏–≤–æ: –≤–∫–∞–∑—É—î–º–æ working-directory: backend, –±–æ —Ç–≤—ñ–π pom.xml —Ç–∞–º
    - name: Build with Maven
      run: mvn clean package -DskipTests
      working-directory: ./backend

    # –ö—Ä–æ–∫ 5: –°—Ç–≤–æ—Ä—é—î–º–æ –†–µ–ª—ñ–∑ –Ω–∞ GitHub (–ó–∞–≤–¥–∞–Ω–Ω—è 1.3)
    - name: Create GitHub Release
      uses: softprops/action-gh-release@v1
      with:
        # –Ü–º'—è —Ç–µ–≥—É –±—É–¥–µ —É–Ω—ñ–∫–∞–ª—å–Ω–∏–º –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫—É (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, build-15)
        tag_name: build-${{ github.run_number }}
        name: Release Build ${{ github.run_number }}
        body: |
          –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π —Ä–µ–ª—ñ–∑ –≤—ñ–¥ –∞–≤—Ç–æ—Ä–∞: ${{ github.actor }}
          –ó–º—ñ–Ω–∏ –±—É–ª–∏ –≤–Ω–µ—Å–µ–Ω—ñ –≤ backend —á–∞—Å—Ç–∏–Ω—É.
        files: backend/target/*.jar # –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –≥–æ—Ç–æ–≤–∏–π —Ñ–∞–π–ª (–∞—Ä—Ç–µ—Ñ–∞–∫—Ç)
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}